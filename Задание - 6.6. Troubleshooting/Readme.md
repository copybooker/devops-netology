# 11. Troubleshooting

## 1. Перед выполнением задания ознакомьтесь с документацией по администрированию MongoDB.
Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD операция в MongoDB и её нужно прервать.
Вы как инженер поддержки решили произвести данную операцию:
·	напишите список операций, которые вы будете производить для остановки запроса пользователя
·	предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB

### Ответ:
Чтобы посмотреть относящиеся к текущему пользователю запросы выполним операцию:
db.currentOp()

Чтобы посмотреть запросы, длящиеся более 3 минут выполним операцию db.currentOp() со значением secs_running 180:

db.currentOp({"secs_running":{$gte: 180}})

Найдем интересующий нас запрос.
Остановим его командой: db.killOp(opid)

Для решения проблемы с долгими запросами проведем анализ медленного запроса через операцию
 explain(‘executionStats’)
Указав ее после самого запроса и по результатам можно будет предложить вариант решения (например перестроить запрос)

## 2. Перед выполнением задания познакомьтесь с документацией по Redis latency troobleshooting.
Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причем отношение количества записанных key-value значений к количеству истёкших значений есть величина постоянная и увеличивается пропорционально количеству реплик сервиса.
При масштабировании сервиса до N реплик вы увидели, что:
·	сначала рост отношения записанных значений к истекшим
·	Redis блокирует операции записи
Как вы думаете, в чем может быть проблема?

### Ответ:
У большого количества ключей (более 25% от общего числа) одновременно истекло TTL, и в процессе их удаления Redis заблокировал операции записи. Согласно документации такие ситуации допускать не рекомендуется.
(In short: be aware that many keys expiring at the same moment can be a source of latency.)

## 3. Вы подняли базу данных MySQL для использования в гис-системе. 
При росте количества записей, в таблицах базы, пользователи начали жаловаться на ошибки вида:
InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '
Как вы думаете, почему это начало происходить и как локализовать проблему?
Какие пути решения данной проблемы вы можете предложить?

### Ответ:
Вероятно выборка замедлилась из-за роста количества записей в таблице, для локализации нужно включить slow_query_log и далее по рекомендации из документации нужно увеличить параметр net_read_timeout с 30 seconds до  60 seconds или больше, требуемого пользователем для обмена информацией с сервером

## 4.
Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объемом данных лучше, чем MySQL.
После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:
postmaster invoked oom-killer
Как вы думаете, что происходит?
Как бы вы решили данную проблему?

### Ответ:
Данная ошибка означает, что закончилась выделенная память и система завершает работу СУБД. Можно попробовать изменить настройки в системе - например увеличить размер свопа, либо перенастроить сам Postgres - выставить ограничение на использование ресурсов хоста

